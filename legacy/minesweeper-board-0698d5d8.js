System.register(["./minesweeper-app-32c11f5c.js"],function(){"use strict";var e,t,r,s,n,a,o,i,u,c,h,l,d,f;return{setters:[function(v){e=v._,t=v.a,r=v.b,s=v.c,n=v.d,a=v.e,o=v.f,i=v.w,u=v.r,c=v.g,h=v.T,l=v.h,d=v.i,f=v.j}],execute:function(){var v=Symbol("value");var g,m,y,b,E,p={initial:"INIT",states:{INIT:{on:{MINE:"MINE",NOT_MINE:"NOT_MINE"}},NOT_MINE:{on:{MARKED:"MARKED",PLAYED:"PLAYED"}},MINE:{on:{MARKED:"MARKED_MINE",PLAYED:"TRIPPED"}},MARKED:{on:{UNMARKED:"NOT_MINE"}},PLAYED:{on:{}},MARKED_MINE:{on:{UNMARKED:"MINE"}},TRIPPED:{on:{}}}},w=function(e,t){return e?p.states[e].on[t]||e:p.initial},N={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},D=function(){function s(e){r(this,s)}return e(s,[{key:"T",value:function(e,t,r){this.Σdt=e,this.M=t,this.Σct=r}},{key:"S",value:function(e,t){return this.update(e,t)}},{key:"update",value:function(e,r){return this.render.apply(this,t(r))}}]),s}(),M=function(e){return function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return{_$litDirective$:e,values:r}}}(function(t){s(c,D);var u=n(c);function c(e){var t,s;if(r(this,c),t=u.call(this,e),e.type!==N.ATTRIBUTE||"class"!==e.name||(null===(s=e.strings)||void 0===s?void 0:s.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.");return a(t)}return e(c,[{key:"render",value:function(e){return Object.keys(e).filter(function(t){return e[t]}).join(" ")}},{key:"update",value:function(e,t){var r=this,s=o(t,1)[0];if(void 0===this.bt){for(var n in this.bt=new Set,s)s[n]&&this.bt.add(n);return this.render(s)}var a=e.element.classList;for(var u in this.bt.forEach(function(e){e in s||(a.remove(e),r.bt.delete(e))}),s){var c=!!s[u];c!==this.bt.has(u)&&(c?(a.add(u),this.bt.add(u)):(a.remove(u),this.bt.delete(u)))}return i}}]),c}()),k=function(t){s(o,l);var a=n(o);function o(){var e;return r(this,o),(e=a.call(this)).state="INIT",e.neighbors=0,e.column=0,e.row=0,e}return e(o,[{key:"_dangerLevel",value:function(){switch(this.state){case"MARKED":case"MARKED_MINE":return"m";case"TRIPPED":return"x";case"PLAYED":return this.neighbors||"";case"MINE":case"NOT_MINE":default:return""}}},{key:"play",value:function(){["MARKED","MARKED_MINE"].includes(this.state)||this.dispatchEvent(new CustomEvent("minesweeper-played"))}},{key:"mark",value:function(e){e.preventDefault(),"PLAYED"!==this.state?this.dispatchEvent(new CustomEvent("minesweeper-marked",{detail:{marked:["MARKED","MARKED_MINE"].includes(this.state)}})):this.play()}},{key:"focus",value:function(){this.shadowRoot.querySelector("button").focus()}},{key:"testDangerLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return"PLAYED"===this.state&&e>t}},{key:"squareType",get:function(){switch(this.state){case"PLAYED":return"Played";case"MARKED":case"MARKED_MINE":return"Marked";default:return"Playable"}}},{key:"render",value:function(){var e=this._dangerLevel();return h(g||(g=c(['<button class="','" tabindex="','" @click="','" @contextmenu="','" aria-label="','">',"</button>"])),M({square:!0,played:["PLAYED","TRIPPED"].includes(this.state),low:this.testDangerLevel(e),medium:this.testDangerLevel(e,1),high:this.testDangerLevel(e,2),worry:this.testDangerLevel(e,5),dead:"TRIPPED"===this.state}),this.canFocus?"0":"-1",this.play,this.mark,"".concat(this.squareType," Square: Column ").concat(this.column+1,", Row ").concat(this.column+1),e)}}],[{key:"properties",get:function(){return{canFocus:{type:Boolean,attribute:"can-focus"},neighbors:{type:Number},state:{type:String},column:{type:Number},row:{type:Number}}}},{key:"styles",get:function(){return[u(m||(m=c([":host{display:flex;line-height:var(--minesweeper-square-size,25px);text-align:center}.square{cursor:pointer;box-sizing:border-box;width:100%;height:100%;border:4px outset;background:var(--color-square-background,#cecece);font-weight:700;font-family:monospace;font-size:2em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.square:focus{transform:translateZ(0);outline:2px solid var(--color-square-focus,#00f);outline-offset:-10px}.played{border:1px solid var(--color-square-border,#999)}.played:focus{outline-offset:-5px}.low{color:var(--color-danger-low,#00f)}.medium{color:var(--color-danger-medium,green)}.high{color:var(--color-danger-high,red)}.worry{color:var(--color-danger-worry,#8b0000)}.dead{background:var(--color-dead,red)}"])))]}}]),o}();customElements.define("minesweeper-square",k);var A={DEAD:"dead",PLAYING:"playing"},I=[0,0],R=function(t){s(i,l);var a=n(i);function i(){var e;return r(this,i),(e=a.call(this)).board=d,e.moves=0,e.marks=0,e.mines=0,e.status=A.PLAYING,e.focusedSquare=I,e.handleKeydown=e.handleKeydown.bind(f(e)),e}return e(i,[{key:"board",get:function(){return this._board},set:function(e){if(e!==this.board){var t,r,s=this.board;this._board=e,this.memoizedGetNeighboringMines=(t=this._getNeighboringMines.bind(this),r=new Map,function(){for(var e=r,s=0,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];for(var i=a.length;e.has(a[s])&&s<i-1;)e=e.get(a[s]),s+=1;if(s===i-1&&e.has(v))e=e.get(v);else{for(;s<i;)e.set(a[s],new Map),e=e.get(a[s]),s+=1;e.set(v,t.apply(void 0,a)),e=e.get(v)}return e}),this.requestUpdate("board",s)}}},{key:"_getNeighbors",value:function(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),n=2;n<r;n++)s[n-2]=arguments[n];var a=0;return this._doNeighbors(e,t,function(e){s.includes(e.state)&&(a+=1)}),a}},{key:"_doNeighbors",value:function(e,t,r){for(var s=-1;s<=1;s+=1)if(this.board[e+s])for(var n=-1;n<=1;n+=1){var a=this.board[e+s][t+n];!a||0===s&&0===n||r(a,s,n)}return 0}},{key:"_getNeighboringMines",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this._getNeighbors.apply(this,t.concat(["MINE","MARKED_MINE","TRIPPED"]))}},{key:"_getNeighboringMarks",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this._getNeighbors.apply(this,t.concat(["MARKED","MARKED_MINE"]))}},{key:"_playNeighbors",value:function(e,t,r){var s=this;this._doNeighbors(e,t,function(n,a,o){(r||"NOT_MINE"===n.state)&&(n.state=w(n.state,"PLAYED"),"TRIPPED"===n.state?s.status=A.DEAD:["MARKED","MARKED_MINE"].includes(n.state)||0!==s.memoizedGetNeighboringMines(e+a,t+o)||s._playNeighbors(e+a,t+o))}),this.moves+=1}},{key:"_played",value:function(e){if(this.status!==A.DEAD){var t=e.target,r=t.column,s=t.row,n=this.board[r][s];if(this.focusedSquare=[r,s],"PLAYED"===n.state){if(this.memoizedGetNeighboringMines(r,s)!==this._getNeighboringMarks(r,s))return;this._playNeighbors(r,s,!0)}else"MINE"===n.state?this.status=A.DEAD:this.memoizedGetNeighboringMines(r,s)||this._playNeighbors(r,s);n.state=w(n.state,"PLAYED"),this.moves+=1}}},{key:"_marked",value:function(e){var t=e.target,r=t.column,s=t.row,n=this.board[r][s];this.focusedSquare=[r,s],n.state=w(n.state,e.detail.marked?"UNMARKED":"MARKED"),this.marks+="MARKED"===n.state||"MARKED_MINE"===n.state?1:-1,this.moves+=1}},{key:"handleKeydown",value:function(e){var t=e.composedPath()[0].getRootNode().host,r=t.column,s=t.row,n=e.shiftKey?5:1;switch(e.key){case"ArrowDown":s=this.board[0].length+s+n;break;case"ArrowUp":s=this.board[0].length+s-n;break;case"ArrowLeft":r=this.board.length+r-n;break;case"ArrowRight":r=this.board.length+r+n;break;case"m":this.shadowRoot.querySelector('[column="'.concat(r,'"][row="').concat(s,'"]')).mark(e)}this.focusedSquare=[r%this.board.length,s%this.board[0].length]}},{key:"focusBoard",value:function(){window.addEventListener("keydown",this.handleKeydown)}},{key:"blurBoard",value:function(){window.removeEventListener("keydown",this.handleKeydown)}},{key:"isFocusedSquare",value:function(e,t){return this.focusedSquare===I?0===e&&0===t:e===this.focusedSquare[0]&&t===this.focusedSquare[1]}},{key:"focusedSquareSelector",get:function(){var e=o(this.focusedSquare,2),t=e[0],r=e[1];return'[column="'.concat(t,'"][row="').concat(r,'"]')}},{key:"render",value:function(){var e=this;return h(y||(y=c(['<div class="status">',"/","</div>",""])),this.marks,this.mines,this.board.map(function(t,r){return t.map(function(t,s){return h(b||(b=c(['<minesweeper-square .state="','" .neighbors="','" column="','" row="','" ?can-focus="','" @minesweeper-played="','" @minesweeper-marked="','" @focus="','" @blur="','"></minesweeper-square>'])),t.state,e.memoizedGetNeighboringMines(r,s),r,s,e.isFocusedSquare(r,s),e._played,e._marked,e.focusBoard,e.blurBoard)})}))}},{key:"updated",value:function(e){if(e.has("status")&&this.status===A.DEAD)this.dispatchEvent(new CustomEvent("minesweeper-game-over",{bubbles:!0,composed:!0}));else if(e.has("mines"))this.marks=0,this.status=A.PLAYING,this.focusedSquare=I;else{var t=this.shadowRoot.querySelector(this.focusedSquareSelector);t.updateComplete.then(function(){t.focus()})}}}],[{key:"properties",get:function(){return{moves:{type:Number},board:{type:Array},marks:{type:Number},mines:{type:Number},status:{type:String},focusedSquare:{type:Array}}}},{key:"styles",get:function(){return[u(E||(E=c([":host{position:relative;display:grid;flex-grow:1;grid-auto-flow:column;grid-template-columns:repeat(var(--columns),1fr);grid-template-rows:repeat(var(--rows),1fr)}.status{position:absolute;bottom:100%;right:0;line-height:48px}"])))]}}]),i}();customElements.define("minesweeper-board",R)}}});
//# sourceMappingURL=minesweeper-board-0698d5d8.js.map
